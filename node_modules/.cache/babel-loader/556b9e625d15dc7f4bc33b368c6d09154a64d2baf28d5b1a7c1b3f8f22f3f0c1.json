{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nimport { jackpotContract } from '../services/jackpotContract';\nimport { backendApi } from '../services/backendApi';\nimport useTonConnect from './useTonConnect';\nimport useTelegramWebApp from './useTelegramWebApp';\nimport socketService from '../services/socketService';\n\n// API polling removed - all data now comes via socket broadcasts\n\nconst useJackpotContract = () => {\n  _s();\n  var _contractState$timer2;\n  // Debug: Log when hook initializes (only on real initialization)\n  const initRef = useRef(false);\n  if (!initRef.current) {\n    console.log('ðŸ”§ useJackpotContract hook initializing...');\n    initRef.current = true;\n  }\n\n  // Contract state\n  const [contractState, setContractState] = useState({\n    totalJackpot: 0,\n    isActive: false,\n    betCount: 0,\n    lastWinner: null,\n    lastWinnerAddress: null,\n    lastPrizeAmount: 0,\n    contractBalance: 0,\n    timestamp: 0,\n    error: null,\n    // Winner detection\n    roundJustEnded: false,\n    hasWinner: false,\n    winnerAnnouncement: null,\n    // Timer information (now integrated)\n    timer: {\n      isActive: false,\n      timeRemaining: 0,\n      timeElapsed: 0,\n      roundNumber: 0\n    },\n    roundDuration: 300,\n    bettors: []\n  });\n\n  // Current round bettors\n  const [currentBettors, setCurrentBettors] = useState([]);\n\n  // Admin info now comes via socket in contract state\n\n  // User-specific state\n  const [userStats] = useState({\n    betAmount: 0,\n    winningProbability: 0,\n    winChancePercentage: '0.00',\n    loading: false,\n    error: null\n  });\n\n  // Loading states\n  const [isPlacingBet, setIsPlacingBet] = useState(false);\n\n  // Essential refs for hook functionality\n  const prevIsActiveRef = useRef(contractState.isActive);\n  const socketInitializedRef = useRef(false);\n\n  // Get wallet connection status\n  const {\n    isConnected,\n    address,\n    sendTransaction,\n    isLoading: walletLoading,\n    isRestoringConnection\n  } = useTonConnect();\n\n  // Get user info for bet notifications\n  const {\n    user\n  } = useTelegramWebApp();\n\n  // REMOVED: All bettor and contract data now comes via socket broadcasts\n\n  // REMOVED: All contract state now comes via socket broadcasts\n\n  // REMOVED: All address tracking and API calls - now handled via socket broadcasts\n\n  // User stats refresh - handled in consolidated polling system\n  // Removed separate useEffect to prevent duplicate API calls\n  // This fixes the issue where APIs were being called 4 times simultaneously\n\n  // Track round changes with ref to prevent re-renders\n  useEffect(() => {\n    var _contractState$timer;\n    const prevIsActive = prevIsActiveRef.current;\n    const currentIsActive = contractState.isActive;\n\n    // Detect new round start (inactive -> active)\n    // But only clear bettors if timer > 0 (actual new round, not waiting for winner)\n    if (!prevIsActive && currentIsActive && ((_contractState$timer = contractState.timer) === null || _contractState$timer === void 0 ? void 0 : _contractState$timer.timeRemaining) > 0) {\n      console.log('ðŸ”„ New round detected, clearing bettors list');\n      setCurrentBettors([]); // Clear bettors list for new round\n    }\n\n    // Update ref for next comparison\n    prevIsActiveRef.current = currentIsActive;\n  }, [contractState.isActive, (_contractState$timer2 = contractState.timer) === null || _contractState$timer2 === void 0 ? void 0 : _contractState$timer2.timeRemaining]);\n\n  // REMOVED: All API polling - now handled entirely via socket broadcasts\n\n  // Socket handling for contract state updates (prevent re-initialization)\n  useEffect(() => {\n    // Prevent duplicate initialization\n    if (socketInitializedRef.current) {\n      console.log('ðŸ”§ Hook: Socket already initialized, skipping');\n      return;\n    }\n    socketInitializedRef.current = true;\n    console.log('ðŸ”§ Hook: Setting up socket listeners (ONCE ONLY)');\n\n    // Listen for full game updates to sync contract state\n    const handleFullGameUpdate = gameData => {\n      console.log('ðŸ”§ Hook: Received full game update:', gameData);\n      setContractState(prevState => {\n        var _gameData$timer$isAct, _gameData$timer, _gameData$timer$timeR, _gameData$timer2, _gameData$timer$round, _gameData$timer3, _gameData$currentRoun;\n        return {\n          ...prevState,\n          ...gameData,\n          // Ensure timer data is preserved/updated\n          timer: {\n            ...prevState.timer,\n            ...gameData.timer,\n            // Fallback to direct properties if timer object doesn't exist\n            isActive: (_gameData$timer$isAct = (_gameData$timer = gameData.timer) === null || _gameData$timer === void 0 ? void 0 : _gameData$timer.isActive) !== null && _gameData$timer$isAct !== void 0 ? _gameData$timer$isAct : gameData.isActive,\n            timeRemaining: (_gameData$timer$timeR = (_gameData$timer2 = gameData.timer) === null || _gameData$timer2 === void 0 ? void 0 : _gameData$timer2.timeRemaining) !== null && _gameData$timer$timeR !== void 0 ? _gameData$timer$timeR : gameData.timeRemaining,\n            roundNumber: (_gameData$timer$round = (_gameData$timer3 = gameData.timer) === null || _gameData$timer3 === void 0 ? void 0 : _gameData$timer3.roundNumber) !== null && _gameData$timer$round !== void 0 ? _gameData$timer$round : (_gameData$currentRoun = gameData.currentRound) === null || _gameData$currentRoun === void 0 ? void 0 : _gameData$currentRoun.roundNumber\n          }\n        };\n      });\n\n      // Update bettors if included in game data\n      if (gameData.bettors && Array.isArray(gameData.bettors)) {\n        console.log('ðŸ”§ Hook: Updating bettors from game data:', gameData.bettors.length, 'bettors');\n        setCurrentBettors(gameData.bettors);\n      }\n    };\n    const handleContractUpdate = contractData => {\n      console.log('ðŸ”§ Hook: Received contract update:', contractData);\n      setContractState(prevState => ({\n        ...prevState,\n        ...contractData\n      }));\n    };\n    const handleBettorsUpdate = bettorsData => {\n      console.log('ðŸ”§ Hook: Received bettors update:', bettorsData);\n      if (bettorsData.bettors) {\n        setCurrentBettors(bettorsData.bettors);\n      }\n    };\n\n    // Set up listeners (removed gameState to avoid duplicates with App.js)\n    socketService.on('fullGameUpdate', handleFullGameUpdate);\n    socketService.on('contractStateUpdate', handleContractUpdate);\n    socketService.on('bettorsUpdate', handleBettorsUpdate);\n    return () => {\n      console.log('ðŸ”§ Hook: Cleaning up socket listeners');\n      socketService.off('fullGameUpdate', handleFullGameUpdate);\n      socketService.off('contractStateUpdate', handleContractUpdate);\n      socketService.off('bettorsUpdate', handleBettorsUpdate);\n      socketInitializedRef.current = false;\n    };\n  }, []); // Empty dependency array - only run once\n\n  // Place a bet (sends real transaction and notifies backend)\n  const placeBet = async betAmount => {\n    console.log(`ðŸŽ° placeBet() called with amount: ${betAmount} TON`);\n    if (!isConnected || !address) {\n      throw new Error('Wallet not connected');\n    }\n    if (!contractState.isActive) {\n      throw new Error('Jackpot is not active');\n    }\n    if (betAmount < 0.1) {\n      throw new Error('Minimum bet is 0.1 TON');\n    }\n    if (betAmount > 10) {\n      throw new Error('Maximum bet is 10 TON');\n    }\n    try {\n      setIsPlacingBet(true);\n      console.log(`ðŸŽ° Placing bet: ${betAmount} TON from ${address}`);\n      console.log(`ðŸ“‹ Contract state: active=${contractState.isActive}, jackpot=${contractState.totalJackpot}`);\n\n      // Build transaction for the smart contract using the contract service\n      console.log(`ðŸ”§ Building transaction with opcode 0x03...`);\n      const transaction = jackpotContract.buildBetTransaction(betAmount, \"EQDhuMbM_cT3dXuJulXmlkA12YF8k5VdpPc1UxkuEqLpCo9K\");\n      console.log(`ðŸ“¤ Sending transaction to contract:`, {\n        contractAddress: transaction.messages[0].address,\n        amount: transaction.messages[0].amount,\n        payloadLength: transaction.messages[0].payload.length\n      });\n\n      // Send transaction via TON Connect\n      const result = await sendTransaction(transaction);\n      console.log('âœ… Bet transaction sent to contract:', result);\n\n      // Show transaction notification\n      if (typeof window !== 'undefined' && window.showTransactionNotification) {\n        window.showTransactionNotification(`ðŸ’° Transaction sent! Your ${betAmount} TON bet will take effect shortly.`, 'success');\n      }\n\n      // Notify backend about the bet with full user data including Telegram ID\n      try {\n        const username = (user === null || user === void 0 ? void 0 : user.displayName) || (user === null || user === void 0 ? void 0 : user.shortName) || (user === null || user === void 0 ? void 0 : user.username);\n        const userData = {\n          amount: betAmount,\n          address: address,\n          username: username,\n          // Include Telegram data for profile picture fetching\n          telegramId: user === null || user === void 0 ? void 0 : user.id,\n          firstName: user === null || user === void 0 ? void 0 : user.firstName,\n          lastName: user === null || user === void 0 ? void 0 : user.lastName\n        };\n        await backendApi.notifyBetPlacement(userData);\n        console.log('âœ… Backend notified about bet placement with full user data:', userData);\n      } catch (notifyError) {\n        console.warn('âš ï¸ Failed to notify backend about bet:', notifyError);\n        // Don't fail the whole transaction for notification errors\n      }\n\n      // Also send chat notification via socket with full user data\n      try {\n        // Emit socket event for chat notification with Telegram data\n        socketService.emit('game:bet', {\n          amount: betAmount,\n          address: address,\n          username: (user === null || user === void 0 ? void 0 : user.displayName) || (user === null || user === void 0 ? void 0 : user.shortName) || (user === null || user === void 0 ? void 0 : user.username),\n          telegramId: user === null || user === void 0 ? void 0 : user.id,\n          firstName: user === null || user === void 0 ? void 0 : user.firstName,\n          lastName: user === null || user === void 0 ? void 0 : user.lastName\n        });\n        console.log('âœ… Chat bet notification sent via socket with full user data');\n      } catch (socketError) {\n        console.warn('âš ï¸ Failed to send chat bet notification:', socketError);\n      }\n\n      // Backend will automatically detect the bet through contract polling\n      console.log('âœ… Bet sent to contract - backend will automatically detect via polling');\n\n      // Simple success response - no bet verification polling\n      console.log('âœ… Bet placed successfully - relying on normal polling for updates');\n      return {\n        success: true,\n        txHash: result.boc || 'unknown',\n        amount: betAmount,\n        address: address\n      };\n    } catch (error) {\n      console.error('âŒ Bet placement failed:', error);\n\n      // Show error notification\n      if (typeof window !== 'undefined' && window.showTransactionNotification) {\n        window.showTransactionNotification(`âŒ Bet failed: ${error.message}`, 'error');\n      }\n      throw error;\n    } finally {\n      setIsPlacingBet(false);\n    }\n  };\n\n  // Helper function to format address\n  const formatAddress = addr => {\n    if (!addr) return null;\n    return `${addr.slice(0, 6)}...${addr.slice(-6)}`;\n  };\n\n  // Helper function to format TON amounts\n  const formatTonAmount = amount => {\n    if (!amount) return '0.000';\n    return parseFloat(amount).toFixed(3);\n  };\n  return {\n    // Contract state\n    contractState: {\n      ...contractState,\n      formattedJackpot: formatTonAmount(contractState.totalJackpot),\n      formattedLastPrize: formatTonAmount(contractState.lastPrizeAmount)\n    },\n    // Admin info (now included in contract state)\n\n    // User state\n    userStats: {\n      ...userStats,\n      formattedBetAmount: formatTonAmount(userStats.betAmount)\n    },\n    // Loading states\n    isPlacingBet,\n    isRestoringConnection,\n    walletLoading,\n    // Actions\n    placeBet,\n    // Utility\n    isConnected,\n    address: address ? formatAddress(address) : null,\n    fullAddress: address,\n    // Backend admin controls (for emergency use only)\n    emergencyControls: {\n      forceStartRound: adminKey => backendApi.forceStartRound(adminKey),\n      forceEndRound: adminKey => backendApi.forceEndRound(adminKey),\n      updateSettings: settings => backendApi.updateAdminSettings(settings)\n    },\n    // Current bettors\n    currentBettors\n  };\n};\n_s(useJackpotContract, \"OdG0EAYf10rpQIjLrO6m9aZFu5k=\", false, function () {\n  return [useTonConnect, useTelegramWebApp];\n});\nexport default useJackpotContract;","map":{"version":3,"names":["useState","useEffect","useRef","jackpotContract","backendApi","useTonConnect","useTelegramWebApp","socketService","useJackpotContract","_s","_contractState$timer2","initRef","current","console","log","contractState","setContractState","totalJackpot","isActive","betCount","lastWinner","lastWinnerAddress","lastPrizeAmount","contractBalance","timestamp","error","roundJustEnded","hasWinner","winnerAnnouncement","timer","timeRemaining","timeElapsed","roundNumber","roundDuration","bettors","currentBettors","setCurrentBettors","userStats","betAmount","winningProbability","winChancePercentage","loading","isPlacingBet","setIsPlacingBet","prevIsActiveRef","socketInitializedRef","isConnected","address","sendTransaction","isLoading","walletLoading","isRestoringConnection","user","_contractState$timer","prevIsActive","currentIsActive","handleFullGameUpdate","gameData","prevState","_gameData$timer$isAct","_gameData$timer","_gameData$timer$timeR","_gameData$timer2","_gameData$timer$round","_gameData$timer3","_gameData$currentRoun","currentRound","Array","isArray","length","handleContractUpdate","contractData","handleBettorsUpdate","bettorsData","on","off","placeBet","Error","transaction","buildBetTransaction","contractAddress","messages","amount","payloadLength","payload","result","window","showTransactionNotification","username","displayName","shortName","userData","telegramId","id","firstName","lastName","notifyBetPlacement","notifyError","warn","emit","socketError","success","txHash","boc","message","formatAddress","addr","slice","formatTonAmount","parseFloat","toFixed","formattedJackpot","formattedLastPrize","formattedBetAmount","fullAddress","emergencyControls","forceStartRound","adminKey","forceEndRound","updateSettings","settings","updateAdminSettings"],"sources":["C:/Users/adams/OneDrive/Desktop/Work/slotpot/src/hooks/useJackpotContract.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\nimport { jackpotContract } from '../services/jackpotContract';\nimport { backendApi } from '../services/backendApi';\nimport useTonConnect from './useTonConnect';\nimport useTelegramWebApp from './useTelegramWebApp';\nimport socketService from '../services/socketService';\n\n// API polling removed - all data now comes via socket broadcasts\n\nconst useJackpotContract = () => {\n  // Debug: Log when hook initializes (only on real initialization)\n  const initRef = useRef(false);\n  if (!initRef.current) {\n    console.log('ðŸ”§ useJackpotContract hook initializing...');\n    initRef.current = true;\n  }\n  \n  // Contract state\n  const [contractState, setContractState] = useState({\n    totalJackpot: 0,\n    isActive: false,\n    betCount: 0,\n    lastWinner: null,\n    lastWinnerAddress: null,\n    lastPrizeAmount: 0,\n    contractBalance: 0,\n    timestamp: 0,\n    error: null,\n    // Winner detection\n    roundJustEnded: false,\n    hasWinner: false,\n    winnerAnnouncement: null,\n    // Timer information (now integrated)\n    timer: {\n      isActive: false,\n      timeRemaining: 0,\n      timeElapsed: 0,\n      roundNumber: 0\n    },\n    roundDuration: 300,\n    bettors: []\n  });\n\n  // Current round bettors\n  const [currentBettors, setCurrentBettors] = useState([]);\n\n  // Admin info now comes via socket in contract state\n\n  // User-specific state\n  const [userStats] = useState({\n    betAmount: 0,\n    winningProbability: 0,\n    winChancePercentage: '0.00',\n    loading: false,\n    error: null\n  });\n\n  // Loading states\n  const [isPlacingBet, setIsPlacingBet] = useState(false);\n\n  // Essential refs for hook functionality\n  const prevIsActiveRef = useRef(contractState.isActive);\n  const socketInitializedRef = useRef(false);\n\n  // Get wallet connection status\n  const { \n    isConnected, \n    address, \n    sendTransaction, \n    isLoading: walletLoading,\n    isRestoringConnection \n  } = useTonConnect();\n\n  // Get user info for bet notifications\n  const { user } = useTelegramWebApp();\n\n  // REMOVED: All bettor and contract data now comes via socket broadcasts\n\n  // REMOVED: All contract state now comes via socket broadcasts\n\n  // REMOVED: All address tracking and API calls - now handled via socket broadcasts\n\n  // User stats refresh - handled in consolidated polling system\n  // Removed separate useEffect to prevent duplicate API calls\n  // This fixes the issue where APIs were being called 4 times simultaneously\n\n  // Track round changes with ref to prevent re-renders\n  useEffect(() => {\n    const prevIsActive = prevIsActiveRef.current;\n    const currentIsActive = contractState.isActive;\n    \n    // Detect new round start (inactive -> active)\n    // But only clear bettors if timer > 0 (actual new round, not waiting for winner)\n    if (!prevIsActive && currentIsActive && contractState.timer?.timeRemaining > 0) {\n      console.log('ðŸ”„ New round detected, clearing bettors list');\n      setCurrentBettors([]); // Clear bettors list for new round\n    }\n    \n    // Update ref for next comparison\n    prevIsActiveRef.current = currentIsActive;\n  }, [contractState.isActive, contractState.timer?.timeRemaining]);\n\n  // REMOVED: All API polling - now handled entirely via socket broadcasts\n\n  // Socket handling for contract state updates (prevent re-initialization)\n  useEffect(() => {\n    // Prevent duplicate initialization\n    if (socketInitializedRef.current) {\n      console.log('ðŸ”§ Hook: Socket already initialized, skipping');\n      return;\n    }\n    \n    socketInitializedRef.current = true;\n    console.log('ðŸ”§ Hook: Setting up socket listeners (ONCE ONLY)');\n    \n    // Listen for full game updates to sync contract state\n    const handleFullGameUpdate = (gameData) => {\n      console.log('ðŸ”§ Hook: Received full game update:', gameData);\n      setContractState(prevState => ({\n        ...prevState,\n        ...gameData,\n        // Ensure timer data is preserved/updated\n        timer: {\n          ...prevState.timer,\n          ...gameData.timer,\n          // Fallback to direct properties if timer object doesn't exist\n          isActive: gameData.timer?.isActive ?? gameData.isActive,\n          timeRemaining: gameData.timer?.timeRemaining ?? gameData.timeRemaining,\n          roundNumber: gameData.timer?.roundNumber ?? gameData.currentRound?.roundNumber\n        }\n      }));\n      \n      // Update bettors if included in game data\n      if (gameData.bettors && Array.isArray(gameData.bettors)) {\n        console.log('ðŸ”§ Hook: Updating bettors from game data:', gameData.bettors.length, 'bettors');\n        setCurrentBettors(gameData.bettors);\n      }\n    };\n\n    const handleContractUpdate = (contractData) => {\n      console.log('ðŸ”§ Hook: Received contract update:', contractData);\n      setContractState(prevState => ({\n        ...prevState,\n        ...contractData\n      }));\n    };\n\n    const handleBettorsUpdate = (bettorsData) => {\n      console.log('ðŸ”§ Hook: Received bettors update:', bettorsData);\n      if (bettorsData.bettors) {\n        setCurrentBettors(bettorsData.bettors);\n      }\n    };\n\n    // Set up listeners (removed gameState to avoid duplicates with App.js)\n    socketService.on('fullGameUpdate', handleFullGameUpdate);\n    socketService.on('contractStateUpdate', handleContractUpdate);\n    socketService.on('bettorsUpdate', handleBettorsUpdate);\n\n    return () => {\n      console.log('ðŸ”§ Hook: Cleaning up socket listeners');\n      socketService.off('fullGameUpdate', handleFullGameUpdate);\n      socketService.off('contractStateUpdate', handleContractUpdate);\n      socketService.off('bettorsUpdate', handleBettorsUpdate);\n      socketInitializedRef.current = false;\n    };\n  }, []); // Empty dependency array - only run once\n\n  // Place a bet (sends real transaction and notifies backend)\n  const placeBet = async (betAmount) => {\n    console.log(`ðŸŽ° placeBet() called with amount: ${betAmount} TON`);\n    \n    if (!isConnected || !address) {\n      throw new Error('Wallet not connected');\n    }\n\n    if (!contractState.isActive) {\n      throw new Error('Jackpot is not active');\n    }\n\n    if (betAmount < 0.1) {\n      throw new Error('Minimum bet is 0.1 TON');\n    }\n\n    if (betAmount > 10) {\n      throw new Error('Maximum bet is 10 TON');\n    }\n\n    try {\n      setIsPlacingBet(true);\n      console.log(`ðŸŽ° Placing bet: ${betAmount} TON from ${address}`);\n      console.log(`ðŸ“‹ Contract state: active=${contractState.isActive}, jackpot=${contractState.totalJackpot}`);\n\n      // Build transaction for the smart contract using the contract service\n      console.log(`ðŸ”§ Building transaction with opcode 0x03...`);\n      const transaction = jackpotContract.buildBetTransaction(betAmount, \"EQDhuMbM_cT3dXuJulXmlkA12YF8k5VdpPc1UxkuEqLpCo9K\");\n      \n      console.log(`ðŸ“¤ Sending transaction to contract:`, {\n        contractAddress: transaction.messages[0].address,\n        amount: transaction.messages[0].amount,\n        payloadLength: transaction.messages[0].payload.length\n      });\n      \n      // Send transaction via TON Connect\n      const result = await sendTransaction(transaction);\n      \n      console.log('âœ… Bet transaction sent to contract:', result);\n\n      // Show transaction notification\n      if (typeof window !== 'undefined' && window.showTransactionNotification) {\n        window.showTransactionNotification(`ðŸ’° Transaction sent! Your ${betAmount} TON bet will take effect shortly.`, 'success');\n      }\n\n      // Notify backend about the bet with full user data including Telegram ID\n      try {\n        const username = user?.displayName || user?.shortName || user?.username;\n        const userData = {\n          amount: betAmount,\n          address: address,\n          username: username,\n          // Include Telegram data for profile picture fetching\n          telegramId: user?.id,\n          firstName: user?.firstName,\n          lastName: user?.lastName\n        };\n        \n        await backendApi.notifyBetPlacement(userData);\n        console.log('âœ… Backend notified about bet placement with full user data:', userData);\n      } catch (notifyError) {\n        console.warn('âš ï¸ Failed to notify backend about bet:', notifyError);\n        // Don't fail the whole transaction for notification errors\n      }\n\n      // Also send chat notification via socket with full user data\n      try {\n        // Emit socket event for chat notification with Telegram data\n        socketService.emit('game:bet', { \n          amount: betAmount,\n          address: address,\n          username: user?.displayName || user?.shortName || user?.username,\n          telegramId: user?.id,\n          firstName: user?.firstName,\n          lastName: user?.lastName\n        });\n        console.log('âœ… Chat bet notification sent via socket with full user data');\n      } catch (socketError) {\n        console.warn('âš ï¸ Failed to send chat bet notification:', socketError);\n      }\n\n      // Backend will automatically detect the bet through contract polling\n      console.log('âœ… Bet sent to contract - backend will automatically detect via polling');\n\n      // Simple success response - no bet verification polling\n      console.log('âœ… Bet placed successfully - relying on normal polling for updates');\n\n      return {\n        success: true,\n        txHash: result.boc || 'unknown',\n        amount: betAmount,\n        address: address\n      };\n    } catch (error) {\n      console.error('âŒ Bet placement failed:', error);\n      \n      // Show error notification\n      if (typeof window !== 'undefined' && window.showTransactionNotification) {\n        window.showTransactionNotification(`âŒ Bet failed: ${error.message}`, 'error');\n      }\n      \n      throw error;\n    } finally {\n      setIsPlacingBet(false);\n    }\n  };\n\n  // Helper function to format address\n  const formatAddress = (addr) => {\n    if (!addr) return null;\n    return `${addr.slice(0, 6)}...${addr.slice(-6)}`;\n  };\n\n  // Helper function to format TON amounts\n  const formatTonAmount = (amount) => {\n    if (!amount) return '0.000';\n    return parseFloat(amount).toFixed(3);\n  };\n\n  return {\n    // Contract state\n    contractState: {\n      ...contractState,\n      formattedJackpot: formatTonAmount(contractState.totalJackpot),\n      formattedLastPrize: formatTonAmount(contractState.lastPrizeAmount)\n    },\n    \n    // Admin info (now included in contract state)\n    \n    // User state\n    userStats: {\n      ...userStats,\n      formattedBetAmount: formatTonAmount(userStats.betAmount)\n    },\n    \n    // Loading states\n    isPlacingBet,\n    isRestoringConnection,\n    walletLoading,\n    \n    // Actions\n    placeBet,\n    \n    // Utility\n    isConnected,\n    address: address ? formatAddress(address) : null,\n    fullAddress: address,\n    \n    // Backend admin controls (for emergency use only)\n    emergencyControls: {\n      forceStartRound: (adminKey) => backendApi.forceStartRound(adminKey),\n      forceEndRound: (adminKey) => backendApi.forceEndRound(adminKey),\n      updateSettings: (settings) => backendApi.updateAdminSettings(settings)\n    },\n    \n    // Current bettors\n    currentBettors\n  };\n};\n\nexport default useJackpotContract;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}