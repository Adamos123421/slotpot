{"ast":null,"code":"class WinnerCoordinator {\n  constructor() {\n    this.isActive = false;\n    this.listeners = new Set();\n    this.currentWinnerTimestamp = null;\n    this.currentWinnerData = null; // Store full winner data for duplicate detection\n  }\n\n  // Register a component that shows winner announcements\n  register(callback) {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  // Set active state and notify all listeners\n  setActive(isActive, winnerTimestamp = null, winnerData = null) {\n    console.log(`ðŸŽ¯ WinnerCoordinator: Setting active state: ${isActive}, timestamp: ${winnerTimestamp}`);\n    this.isActive = isActive;\n    this.currentWinnerTimestamp = winnerTimestamp;\n    this.currentWinnerData = winnerData;\n\n    // Notify all registered components\n    this.listeners.forEach(callback => {\n      try {\n        callback({\n          isActive,\n          winnerTimestamp\n        });\n      } catch (error) {\n        console.error('Error in winner coordinator callback:', error);\n      }\n    });\n  }\n\n  // Check if a winner announcement should be blocked\n  shouldBlock(winnerTimestamp, winnerData = null) {\n    const isAlreadyActive = this.isActive;\n    const isDuplicateTimestamp = this.currentWinnerTimestamp === winnerTimestamp;\n\n    // Also check for duplicate winner data (same winner in same round)\n    let isDuplicateWinner = false;\n    if (winnerData && this.currentWinnerData) {\n      isDuplicateWinner = winnerData.winner === this.currentWinnerData.winner && winnerData.roundNumber === this.currentWinnerData.roundNumber && winnerData.prize === this.currentWinnerData.prize;\n    }\n    const shouldBlock = isAlreadyActive || isDuplicateTimestamp || isDuplicateWinner;\n    console.log(`ðŸŽ¯ WinnerCoordinator shouldBlock check:`, {\n      isActive: isAlreadyActive,\n      currentTimestamp: this.currentWinnerTimestamp,\n      incomingTimestamp: winnerTimestamp,\n      isDuplicateTimestamp,\n      isDuplicateWinner,\n      shouldBlock\n    });\n    return shouldBlock;\n  }\n\n  // Clear all states (for new rounds)\n  reset() {\n    console.log('ðŸ”„ WinnerCoordinator: Resetting all states');\n    this.setActive(false, null);\n  }\n\n  // Get current state\n  getState() {\n    return {\n      isActive: this.isActive,\n      currentWinnerTimestamp: this.currentWinnerTimestamp\n    };\n  }\n}\n\n// Create singleton instance\nconst winnerCoordinator = new WinnerCoordinator();\nexport default winnerCoordinator;","map":{"version":3,"names":["WinnerCoordinator","constructor","isActive","listeners","Set","currentWinnerTimestamp","currentWinnerData","register","callback","add","delete","setActive","winnerTimestamp","winnerData","console","log","forEach","error","shouldBlock","isAlreadyActive","isDuplicateTimestamp","isDuplicateWinner","winner","roundNumber","prize","currentTimestamp","incomingTimestamp","reset","getState","winnerCoordinator"],"sources":["C:/Users/adams/OneDrive/Desktop/Work/slotpot/src/services/winnerCoordinator.js"],"sourcesContent":["class WinnerCoordinator {\r\n  constructor() {\r\n    this.isActive = false;\r\n    this.listeners = new Set();\r\n    this.currentWinnerTimestamp = null;\r\n    this.currentWinnerData = null; // Store full winner data for duplicate detection\r\n  }\r\n\r\n  // Register a component that shows winner announcements\r\n  register(callback) {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  // Set active state and notify all listeners\r\n  setActive(isActive, winnerTimestamp = null, winnerData = null) {\r\n    console.log(`ðŸŽ¯ WinnerCoordinator: Setting active state: ${isActive}, timestamp: ${winnerTimestamp}`);\r\n    this.isActive = isActive;\r\n    this.currentWinnerTimestamp = winnerTimestamp;\r\n    this.currentWinnerData = winnerData;\r\n    \r\n    // Notify all registered components\r\n    this.listeners.forEach(callback => {\r\n      try {\r\n        callback({ isActive, winnerTimestamp });\r\n      } catch (error) {\r\n        console.error('Error in winner coordinator callback:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Check if a winner announcement should be blocked\r\n  shouldBlock(winnerTimestamp, winnerData = null) {\r\n    const isAlreadyActive = this.isActive;\r\n    const isDuplicateTimestamp = this.currentWinnerTimestamp === winnerTimestamp;\r\n    \r\n    // Also check for duplicate winner data (same winner in same round)\r\n    let isDuplicateWinner = false;\r\n    if (winnerData && this.currentWinnerData) {\r\n      isDuplicateWinner = (\r\n        (winnerData.winner === this.currentWinnerData.winner) &&\r\n        (winnerData.roundNumber === this.currentWinnerData.roundNumber) &&\r\n        (winnerData.prize === this.currentWinnerData.prize)\r\n      );\r\n    }\r\n    \r\n    const shouldBlock = isAlreadyActive || isDuplicateTimestamp || isDuplicateWinner;\r\n    \r\n    console.log(`ðŸŽ¯ WinnerCoordinator shouldBlock check:`, {\r\n      isActive: isAlreadyActive,\r\n      currentTimestamp: this.currentWinnerTimestamp,\r\n      incomingTimestamp: winnerTimestamp,\r\n      isDuplicateTimestamp,\r\n      isDuplicateWinner,\r\n      shouldBlock\r\n    });\r\n    \r\n    return shouldBlock;\r\n  }\r\n\r\n  // Clear all states (for new rounds)\r\n  reset() {\r\n    console.log('ðŸ”„ WinnerCoordinator: Resetting all states');\r\n    this.setActive(false, null);\r\n  }\r\n\r\n  // Get current state\r\n  getState() {\r\n    return {\r\n      isActive: this.isActive,\r\n      currentWinnerTimestamp: this.currentWinnerTimestamp\r\n    };\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nconst winnerCoordinator = new WinnerCoordinator();\r\nexport default winnerCoordinator; "],"mappings":"AAAA,MAAMA,iBAAiB,CAAC;EACtBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,QAAQ,GAAG,KAAK;IACrB,IAAI,CAACC,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC1B,IAAI,CAACC,sBAAsB,GAAG,IAAI;IAClC,IAAI,CAACC,iBAAiB,GAAG,IAAI,CAAC,CAAC;EACjC;;EAEA;EACAC,QAAQA,CAACC,QAAQ,EAAE;IACjB,IAAI,CAACL,SAAS,CAACM,GAAG,CAACD,QAAQ,CAAC;IAC5B,OAAO,MAAM,IAAI,CAACL,SAAS,CAACO,MAAM,CAACF,QAAQ,CAAC;EAC9C;;EAEA;EACAG,SAASA,CAACT,QAAQ,EAAEU,eAAe,GAAG,IAAI,EAAEC,UAAU,GAAG,IAAI,EAAE;IAC7DC,OAAO,CAACC,GAAG,CAAC,+CAA+Cb,QAAQ,gBAAgBU,eAAe,EAAE,CAAC;IACrG,IAAI,CAACV,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACG,sBAAsB,GAAGO,eAAe;IAC7C,IAAI,CAACN,iBAAiB,GAAGO,UAAU;;IAEnC;IACA,IAAI,CAACV,SAAS,CAACa,OAAO,CAACR,QAAQ,IAAI;MACjC,IAAI;QACFA,QAAQ,CAAC;UAAEN,QAAQ;UAAEU;QAAgB,CAAC,CAAC;MACzC,CAAC,CAAC,OAAOK,KAAK,EAAE;QACdH,OAAO,CAACG,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAC/D;IACF,CAAC,CAAC;EACJ;;EAEA;EACAC,WAAWA,CAACN,eAAe,EAAEC,UAAU,GAAG,IAAI,EAAE;IAC9C,MAAMM,eAAe,GAAG,IAAI,CAACjB,QAAQ;IACrC,MAAMkB,oBAAoB,GAAG,IAAI,CAACf,sBAAsB,KAAKO,eAAe;;IAE5E;IACA,IAAIS,iBAAiB,GAAG,KAAK;IAC7B,IAAIR,UAAU,IAAI,IAAI,CAACP,iBAAiB,EAAE;MACxCe,iBAAiB,GACdR,UAAU,CAACS,MAAM,KAAK,IAAI,CAAChB,iBAAiB,CAACgB,MAAM,IACnDT,UAAU,CAACU,WAAW,KAAK,IAAI,CAACjB,iBAAiB,CAACiB,WAAY,IAC9DV,UAAU,CAACW,KAAK,KAAK,IAAI,CAAClB,iBAAiB,CAACkB,KAC9C;IACH;IAEA,MAAMN,WAAW,GAAGC,eAAe,IAAIC,oBAAoB,IAAIC,iBAAiB;IAEhFP,OAAO,CAACC,GAAG,CAAC,yCAAyC,EAAE;MACrDb,QAAQ,EAAEiB,eAAe;MACzBM,gBAAgB,EAAE,IAAI,CAACpB,sBAAsB;MAC7CqB,iBAAiB,EAAEd,eAAe;MAClCQ,oBAAoB;MACpBC,iBAAiB;MACjBH;IACF,CAAC,CAAC;IAEF,OAAOA,WAAW;EACpB;;EAEA;EACAS,KAAKA,CAAA,EAAG;IACNb,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC;IACzD,IAAI,CAACJ,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC;EAC7B;;EAEA;EACAiB,QAAQA,CAAA,EAAG;IACT,OAAO;MACL1B,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBG,sBAAsB,EAAE,IAAI,CAACA;IAC/B,CAAC;EACH;AACF;;AAEA;AACA,MAAMwB,iBAAiB,GAAG,IAAI7B,iBAAiB,CAAC,CAAC;AACjD,eAAe6B,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}